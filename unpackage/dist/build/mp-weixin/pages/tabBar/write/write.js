"use strict";const e=require("../../../common/vendor.js"),t={components:{},onShareAppMessage:e=>("button"===e.from&&console.log(e.target),{title:"瑶一瑶小可爱的表情包",path:"pages/tabBar/home/home"}),data:()=>({currentSort:1,recordSort:1,currentPage:1,totalPageNum:50,pageSize:5,banner_info:[{url:"https://mmbiz.qpic.cn/mmbiz_png/NiaDlMDtNVMFaABHQ9n9F0FISFrJF1bcIrS3S5FQ2cHYjqmJBWia18r0o82iccp1tk3vnTjMb7OvjxOhLfX6K2vicA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1"}],modeIndex:-1,styleIndex:-1,current:0,mode:"default",dotsStyles:{},swiperDotIndex:0,title:"uni-fab",pattern:{color:"#7A7E83",backgroundColor:"#fff",selectedColor:"#7A7E83",buttonColor:"#356dff",iconColor:"#ecf4ff"},content:[{iconPath:"/static/pin.png",selectedIconPath:"/static/pin.png",text:"标记页面",active:!1},{iconPath:"/static/skip.png",selectedIconPath:"/static/skip.png",text:"前往标记",active:!1},{iconPath:"/static/arrow-left-circle.png",selectedIconPath:"/static/arrow-left-circle.png",text:"首页",active:!1}],sectionTip:"您可以在这里分享你的想法或心事，按最新排序~\n每条消息会经过管理员的审核后才能呈现\n一旦发现违法违规/诱导消息等直接删除不予通知\n请注意保护个人隐私，谨防受骗\n",dynamicList:[],rules:{title:{rules:[{required:!0,errorMessage:"标题不能为空"},{validateFunction:(e,t,o,n)=>new Promise(((e,o)=>{setTimeout((()=>{t.replace(/[^\x00-\xff]/g,"01").length<=32?e():o(new Error("字数必须小于16,2英文=1中文"))}),200)}))}]},desc:{rules:[{validateFunction:(e,t,o,n)=>new Promise(((e,o)=>{setTimeout((()=>{t.replace(/[^\x00-\xff]/g,"01").length<=40?e():o(new Error("字数必须小于20,2英文=1中文"))}),200)}))}]},info:{rules:[{required:!0,errorMessage:"内容不能为空"},{validateFunction:(e,t,o,n)=>new Promise(((e,o)=>{setTimeout((()=>{t.replace(/[^\x00-\xff]/g,"01").length<=1e3?e():o(new Error("字数必须小于500,2英文=1中文"))}),200)}))}]}},valiFormData:{title:"",desc:"",info:""}}),onLoad(){let t=this;const o=e.Ds.database();o.collection("update_record").where("k_type==-1").orderBy("create_time desc").get().then((e=>{e.result.data.length>0&&(this.sectionTip=e.result.data[0].show_time)})).catch((e=>{console.log(e)})),o.collection("write").where("status=='1'").skip(0).limit(this.pageSize).orderBy("create_time desc").get().then((e=>{0==e.result.data.length?this.totalPageNum=1:(e.result.data.length<this.pageSize&&(this.totalPageNum=1),this.dynamicList=[],e.result.data.forEach(((e,t)=>{this.dynamicList.push({title:e.title,desc:e.desc,info:e.info,extra:e.extra})})))})).catch((e=>{console.log(e)})),o.collection("write").where("status=='1'").count().then((e=>{this.totalPageNum=e.result.total})).catch((e=>{console.log(e)})),e.index.getStorage({key:"current_sort_key",success:function(e){console.log("current_sort_key:",e.data),t.currentSort=e.data}})},methods:{trigger(t){console.log(t),this.content[t.index].active=!t.item.active;let o="确定前往首页吗？";"标记页面"==t.item.text?o="确定标记当前页面吗？":"前往标记"==t.item.text&&(o="确定前往上次标记的页面吗？");let n=this;e.index.showModal({title:"提示",content:o,success:function(o){o.confirm?"标记页面"==t.item.text?(n.currentSort=n.currentPage,e.index.setStorage({key:"current_sort_key",data:n.currentSort,success:function(){console.log("setStorage success")}}),console.log(n.currentSort)):"前往标记"==t.item.text?(n.currentPage=n.currentSort,n.jumpPage(n.currentSort)):"首页"==t.item.text&&(n.currentPage=1,n.jumpPage(1)):o.cancel&&console.log("用户点击取消")}})},changePage(e){console.log(e),this.currentPage=e.current,this.jumpPage(e.current)},jumpPage:function(t){console.log("===========jumpPage==============");let o=this.pageSize*(this.currentPage-1);e.Ds.database().collection("write").where("status=='1'").skip(o).limit(this.pageSize).orderBy("create_time desc").get().then((e=>{0==e.result.data.length?this.totalPageNum=this.pageSize*(this.currentPage-1):(e.result.data.length<this.pageSize&&(this.totalPageNum=this.pageSize*this.currentPage),this.dynamicList=[],e.result.data.forEach(((e,t)=>{this.dynamicList.push({title:e.title,desc:e.desc,info:e.info,extra:e.extra})})))})).catch((e=>{console.log(e)}))},inputDialogToggle(){this.$refs.inputDialog.open()},submit(t){this.$refs[t].validate().then((t=>{console.log("表单提交内容:",t);const o=e.Ds.database();var n=new Date;let i=n.getFullYear()-2e3+"-"+(n.getMonth()+1)+"-"+n.getDate(),a=parseInt((new Date).getTime()/1e3)+"";console.log(a),o.collection("write").add({title:t.title,desc:t.desc,info:t.info,status:"0",extra:i}).then((t=>{e.index.showToast({title:"提交成功"}),this.valiFormData.title="",this.valiFormData.desc="",this.valiFormData.info="",this.$refs.inputDialog.close()})).catch((t=>{e.index.showModal({content:t.message||"系统异常，等待修复",showCancel:!1})}))})).catch((e=>{console.log("err",e)}))}}};if(!Array){(e.resolveComponent("uni-swiper-dot")+e.resolveComponent("uni-fab")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-card")+e.resolveComponent("uni-pagination")+e.resolveComponent("uni-section"))()}Math||((()=>"../../../uni_modules/uni-swiper-dot/components/uni-swiper-dot/uni-swiper-dot.js")+(()=>"../../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../../uni_modules/uni-pagination/components/uni-pagination/uni-pagination.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js"))();const o=e._export_sfc(t,[["render",function(t,o,n,i,a,r){return{a:e.f(a.banner_info,((e,t,o)=>({a:e.url,b:t}))),b:e.o(((...e)=>t.changeBanner&&t.changeBanner(...e))),c:a.swiperDotIndex,d:e.p({current:a.current,mode:a.mode}),e:e.sr("fab","bdc502b4-1"),f:e.o(r.trigger),g:e.p({horizontal:"right",vertical:"top",direction:"vertical",pattern:a.pattern,content:a.content}),h:e.o(((...e)=>r.inputDialogToggle&&r.inputDialogToggle(...e))),i:e.o((e=>a.valiFormData.title=e)),j:e.p({maxlength:"51",placeholder:"不超过16个字",modelValue:a.valiFormData.title}),k:e.p({label:"标题",required:!0,name:"title"}),l:e.o((e=>a.valiFormData.desc=e)),m:e.p({maxlength:"50",placeholder:"不超过20个字",modelValue:a.valiFormData.desc}),n:e.p({label:"简介/个签",name:"desc"}),o:e.o((e=>a.valiFormData.info=e)),p:e.p({type:"textarea",maxlength:"800",placeholder:"不超过500个字;请勿输入不良内容,注重保护个人隐私,未经管理员审核通过的直接删除不予发布,最终解释权归作者所有",modelValue:a.valiFormData.info}),q:e.p({label:"内容",required:!0,name:"info"}),r:e.sr("valiForm","bdc502b4-4,bdc502b4-3"),s:e.p({rules:a.rules,modelValue:a.valiFormData,"label-position":"top"}),t:e.o((e=>r.submit("valiForm"))),v:e.sr("inputDialog","bdc502b4-3,bdc502b4-2"),w:e.p({type:"dialog"}),x:e.f(a.dynamicList,((t,o,n)=>({a:e.t(t.info),b:"bdc502b4-11-"+n+",bdc502b4-2",c:e.p({title:t.title,"sub-title":t.desc,extra:t.extra}),d:o,e:o}))),y:e.o(r.changePage),z:e.p({total:a.totalPageNum,pageSize:a.pageSize,current:a.currentPage,title:"分页"}),A:e.p({title:a.sectionTip,titleColor:"#fd6608"})}}]]);t.__runtimeHooks=2,wx.createPage(o);
